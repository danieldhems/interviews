"use strict";angular.module("Interviews",["ngCookies","ngResource","ngSanitize","ngRoute","ui.bootstrap","uiGmapgoogle-maps","geocoder","ngStorage","ngAutocomplete","xeditable"]).config(["$routeProvider","$locationProvider",function(a,b){a.otherwise({redirectTo:"/",controller:"MainCtrl"}),b.html5Mode(!0)}]).config(["uiGmapGoogleMapApiProvider",function(a){a.configure({key:"AIzaSyC0ojvwjVe4Ly7fDvzygU719J_vbrdFsMc",v:"3.17",libraries:"places,weather,geometry,visualization"})}]),angular.module("geocoder",["ngStorage"]).factory("geocoder",["$localStorage","$q","$timeout","$rootScope",function(a,b,c,d){var e=a.locations?JSON.parse(a.locations):{},f=[],g=250,h=function(){var b=f[0],i=new google.maps.Geocoder;i.geocode({address:b.address},function(i,j){if(j===google.maps.GeocoderStatus.OK){var k={lat:i[0].geometry.location.lat(),lng:i[0].geometry.location.lng(),formattedAddress:i[0].formatted_address};e[b.address]=k,a.locations=JSON.stringify(e),f.shift(),b.d.resolve(k)}else j===google.maps.GeocoderStatus.ZERO_RESULTS?(f.shift(),b.d.reject({type:"zero",message:"Zero results for geocoding address "+b.address})):j===google.maps.GeocoderStatus.OVER_QUERY_LIMIT?b.executedAfterPause&&(f.shift(),b.d.reject({type:"busy",message:"Geocoding server is busy can not process address "+b.address})):j===google.maps.GeocoderStatus.REQUEST_DENIED?(f.shift(),b.d.reject({type:"denied",message:"Request denied for geocoding address "+b.address})):(f.shift(),b.d.reject({type:"invalid",message:"Invalid request for geocoding: status="+j+", address="+b.address}));if(f.length)if(j===google.maps.GeocoderStatus.OVER_QUERY_LIMIT){var l=f[0];l.executedAfterPause=!0,c(h,g)}else c(h,0);d.$$phase||d.$apply()})};return{geocodeAddress:function(a){var c=b.defer();return _.has(e,a)?c.resolve(e[a]):(f.push({address:a,d:c}),1===f.length&&h()),c.promise}}}]),angular.module("Interviews").controller("MainCtrl",["$http","$scope",function(a,b){b.interviews=[],a.get("/api/interviews",b.newinterview).success(function(a){b.updateResults(a)}),b.mapDefaultSettings={center:{latitude:"51.510830",longitude:"-0.076132"},zoom:13},b.map=b.mapDefaultSettings,b.control={},b.centerMap=function(a){void 0!==a&&(b.control.refresh({latitude:a.latitude,longitude:a.longitude}),b.map.zoom=14,b.currentInterviewCoords={latitude:a.lat,longitude:a.lng})},b.resetMap=function(){b.map=b.mapDefaultSettings},b.prependinterview=function(a){b.interviews.unshift(a)},b.updateResults=function(a){b.interviews=a},b["delete"]=function(c){a["delete"]("/api/interviews/"+c).success(function(){_.forEach(b.interviews,function(a,d){a._id===c&&b.interviews.splice(d,1)})})}}]),angular.module("Interviews").filter("date",function(){return function(a){return moment(a).format("MMM Do, YYYY [at] hh:mm")}}),angular.module("Interviews").config(["$routeProvider",function(a){a.when("/",{templateUrl:"app/main/main.html",controller:"MainCtrl"})}]),angular.module("Interviews").controller("NewCtrl",["$scope","$http","geocoder",function(a,b){a.interview={},a.placeData={},a.newinterviewForm=$(".new-interview"),a.isSubmitted=!1,a.submissionSuccess=!1,a.submissionError=!1,a.save=function(){a.placeData.hasOwnProperty("geometry")&&(a.interview.location={latitude:a.placeData.geometry.location.k,longitude:a.placeData.geometry.location.D}),a.interview.dateCreated=new Date,a.isSubmitted=!0,b.post("/api/interviews",a.interview).success(function(b){b&&(a.submissionSuccess=!0)}).error(function(b){a.submissionError=!0,console.log(b)})},a.resetForm=function(){a.isSubmitted=!1,a.submissionSuccess=!1}}]),angular.module("Interviews").config(["$routeProvider",function(a){a.when("/new",{templateUrl:"app/new/new.html",controller:"NewCtrl"})}]),angular.module("angularFullstackApp").run(["$templateCache",function(a){a.put("app/main/main.html",'<ui-gmap-google-map center=map.center zoom=map.zoom control=control><ui-gmap-markers models=interviews coords="\'location\'" idkey="\'client\'" icon="\'icon\'" labelcontent="\'client\'" fit=true></ui-gmap-markers></ui-gmap-google-map><a href=new>Add interview</a> <a href=# ng-click=resetMap()>Overview</a><ul class=list><li id={{interview._id}} class=interview ng-repeat="interview in interviews track by $index | orderBy: \'date_created\':true"><h2 class=title>{{interview.client}}</h2><p>{{interview.recruiter}} / {{interview.salary}}</p><a href=/interview/{{interview._id}}>View more</a> <a href=# ng-click="centerMap( interview.location )">Show on map</a> <a href=/interview/{{interview._id}}/edit>edit</a> <a href=# ng-click=delete(interview._id)>Delete</a></li></ul>'),a.put("app/new/new.html",'<div class=container ng-controller=NewCtrl><div class=form-new><form class=form ng-submit=save() ng-show=!isSubmitted><h1>Add interview</h1><input id=client ng-model=interview.client placeholder=Client> <input id=address ng-model=interview.address placeholder=address ng-autocomplete details=placeData options={watchEnter:true}> <input id=salary ng-model=interview.salary placeholder=salary> <input id=recruiter ng-model=interview.recruiter placeholder=recruiter> <input type=submit value=Add></form><div ng-show=submissionSuccess><p>Interview added</p><a href=# ng-click=resetForm()>Add another?</a> <a href="/">Return</a></div></div></div>')}]);